<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Todo List</h2>
      <a routerLink="/add-todo" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Add New Todo
      </a>
    </div>

    <!-- Filters and Search -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-funnel"></i> Filters & Search</h5>
      </div>
      <div class="card-body">
        <!-- Search -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="search" class="form-label">Search</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-search"></i>
              </span>
              <input
                type="text"
                class="form-control"
                id="search"
                placeholder="Search by title or description..."
                [(ngModel)]="searchText"
                (input)="onSearchChange()"
              />
            </div>
          </div>
        </div>

        <!-- Filters -->
        <div class="row mb-3">
          <div class="col-md-3">
            <label for="statusFilter" class="form-label">Status</label>
            <select
              class="form-select"
              id="statusFilter"
              [(ngModel)]="filterStatus"
              (change)="onFilterChange()"
            >
              <option *ngFor="let status of statusOptions" [value]="status">
                {{ status === 'all' ? 'All Statuses' : (status | titlecase) }}
              </option>
            </select>
          </div>

          <div class="col-md-3">
            <label for="priorityFilter" class="form-label">Priority</label>
            <select
              class="form-select"
              id="priorityFilter"
              [(ngModel)]="filterPriority"
              (change)="onFilterChange()"
            >
              <option
                *ngFor="let priority of priorityOptions"
                [value]="priority"
              >
                {{
                  priority === 'all' ? 'All Priorities' : (priority | titlecase)
                }}
              </option>
            </select>
          </div>

          <div class="col-md-3">
            <label for="categoryFilter" class="form-label">Category</label>
            <select
              class="form-select"
              id="categoryFilter"
              [(ngModel)]="filterCategory"
              (change)="onFilterChange()"
            >
              <option
                *ngFor="let category of categoryOptions"
                [value]="category"
              >
                {{
                  category === 'all' ? 'All Categories' : (category | titlecase)
                }}
              </option>
            </select>
          </div>

          <div class="col-md-3">
            <label for="sortBy" class="form-label">Sort By</label>
            <div class="input-group">
              <select
                class="form-select"
                id="sortBy"
                [(ngModel)]="sortBy"
                (change)="onSortChange()"
              >
                <option
                  *ngFor="let option of sortOptions"
                  [value]="option.value"
                >
                  {{ option.label }}
                </option>
              </select>
              <button
                class="btn btn-outline-secondary"
                type="button"
                (click)="
                  sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
                  onSortChange()
                "
                title="Toggle sort order"
              >
                <i
                  class="bi"
                  [class.bi-sort-alpha-down]="sortOrder === 'asc'"
                  [class.bi-sort-alpha-up]="sortOrder === 'desc'"
                ></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Clear Filters Button -->
        <div class="row">
          <div class="col-12">
            <button
              class="btn btn-outline-secondary btn-sm"
              (click)="clearFilters()"
            >
              <i class="bi bi-x-circle"></i> Clear All Filters
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Count -->
    <div class="mb-3">
      <small class="text-muted">
        Showing {{ todos.length }} of {{ allTodos.length }} todos
      </small>
    </div>

    <div *ngIf="todos.length === 0" class="alert alert-info text-center">
      <h4>No todos available</h4>
      <p>
        Get started by <a routerLink="/add-todo">adding your first todo</a>!
      </p>
    </div>

    <div class="row" *ngIf="todos.length > 0">
      <div class="col-md-6 col-lg-4 mb-3" *ngFor="let todo of todos">
        <div class="card h-100" [class.border-danger]="isOverdue(todo)">
          <div class="card-header p-2">
            <div class="d-flex justify-content-between align-items-center">
              <span class="badge {{ getStatusBadgeClass(todo.status) }}">
                {{ todo.status | titlecase }}
              </span>
              <span class="badge {{ getPriorityBadgeClass(todo.priority) }}">
                {{ todo.priority | titlecase }}
              </span>
            </div>
          </div>

          <div class="card-body">
            <h5
              class="card-title"
              [class.text-decoration-line-through]="todo.isCompleted"
              [class.text-success]="todo.isCompleted"
            >
              <a [routerLink]="['/todo', todo.id]" 
                 class="text-decoration-none"
                 [class.text-success]="todo.isCompleted">
                {{ todo.title }}
              </a>
            </h5>
            <p class="card-text text-muted small mb-2">
              <i class="bi bi-tag"></i> {{ todo.category | titlecase }}
            </p>
            <p class="card-text" 
               [class.text-muted]="!todo.isCompleted"
               [class.text-success]="todo.isCompleted">
              {{ todo.description }}
            </p>

            <div *ngIf="todo.dueDate" class="mb-2">
              <small class="text-muted">
                <i class="bi bi-calendar-event"></i>
                Due: {{ formatDate(todo.dueDate) }}
                <span *ngIf="isOverdue(todo)" class="text-danger ms-1">
                  <i class="bi bi-exclamation-triangle"></i> Overdue
                </span>
              </small>
            </div>
          </div>

          <div class="card-footer p-2">
            <div class="btn-group w-100" role="group">
              <button
                class="btn btn-sm"
                [class.btn-success]="!todo.isCompleted"
                [class.btn-warning]="todo.isCompleted"
                (click)="toggleStatus(todo)"
                title="{{
                  todo.isCompleted ? 'Mark as Pending' : 'Mark as Completed'
                }}"
              >
                <i
                  class="bi"
                  [class.bi-check-circle]="!todo.isCompleted"
                  [class.bi-arrow-clockwise]="todo.isCompleted"
                ></i>
              </button>

              <a
                [routerLink]="['/edit-todo', todo.id]"
                class="btn btn-outline-primary btn-sm"
                title="Edit Todo"
              >
                <i class="bi bi-pencil"></i>
              </a>

              <button
                class="btn btn-outline-danger btn-sm"
                (click)="deleteTodo(todo.id)"
                title="Delete Todo"
              >
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
